<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HealthCare — Live Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* ---- STYLES SAME AS YOUR ORIGINAL ---- */
    :root {
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --secondary: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --radius: 12px;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
    body{background-color:var(--bg);color:var(--text);padding:20px;}
    .container{max-width:1200px;margin:auto;}
    header,footer{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
    .logo{display:flex;align-items:center;gap:10px;}
    .logo-icon{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;border-radius:10px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:20px;}
    .status-indicator{display:flex;align-items:center;gap:8px;background:var(--card);padding:8px 18px;border-radius:20px;box-shadow:var(--shadow);}
    .status-dot{width:10px;height:10px;border-radius:50%;background:var(--warning);animation:pulse 2s infinite;}
    .status-dot.connected{background:var(--secondary);}
    @keyframes pulse{0%{opacity:1;}50%{opacity:.5;}100%{opacity:1;}}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px;}
    .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .card-title{color:var(--text-muted);font-weight:600;font-size:14px;text-transform:uppercase;}
    .card-icon{font-size:22px;}
    .card-value{font-size:30px;font-weight:700;margin-bottom:5px;}
    .metric-badge{font-size:12px;padding:4px 8px;border-radius:20px;}
    .normal{background:rgba(16,185,129,0.1);color:var(--secondary);}
    .warning{background:rgba(245,158,11,0.1);color:var(--warning);}
    .critical{background:rgba(239,68,68,0.1);color:var(--danger);}
    .chart-card{grid-column:1/-1;}
    footer{border-top:1px solid var(--border);padding-top:10px;font-size:13px;color:var(--text-muted);}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon"><i class="fas fa-heartbeat"></i></div>
        <div>
          <h2>HealthCare Dashboard</h2>
          <p style="color:var(--text-muted);font-size:14px;">Real-time Patient Monitoring</p>
        </div>
      </div>
      <div class="status-indicator">
        <div id="statusDot" class="status-dot"></div>
        <span id="statusText">Connecting...</span>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Heart Rate</div>
          <i class="fas fa-heart" style="color:var(--danger);"></i>
        </div>
        <div id="bpm" class="card-value">-- <span class="metric-badge normal">Normal</span></div>
        <div class="card-footer" id="bpmUpdated">Last update: --</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Body Temperature</div>
          <i class="fas fa-thermometer-half" style="color:var(--warning);"></i>
        </div>
        <div id="temp" class="card-value">-- <span class="metric-badge normal">Normal</span></div>
        <div class="card-footer" id="tempUpdated">Last update: --</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Pulse Sensor</div>
          <i class="fas fa-wave-square" style="color:var(--secondary);"></i>
        </div>
        <div id="raw" class="card-value">--</div>
        <div class="card-footer" id="rawUpdated">Last update: --</div>
      </div>

      <div class="card chart-card">
        <h3>Heart Rate History</h3>
        <canvas id="bpmChart" height="100"></canvas>
      </div>
    </div>

    <footer>
      <span id="connText">Connecting to Firebase...</span>
      <span>© 2025 SPS Project Hub</span>
    </footer>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCXNdT863O6m5Q_suM1oG4KbjEd0DxLqQo",
      authDomain: "health-care-f0262.firebaseapp.com",
      databaseURL: "https://health-care-f0262-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "health-care-f0262",
      storageBucket: "health-care-f0262.firebasestorage.app",
      messagingSenderId: "1001741084003",
      appId: "1:1001741084003:web:3e1bfe9f0fa8b6a03c1f56"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Realtime data paths
    const bpmRef = ref(db, "HealthCare/HeartRate/BPM");
    const tempRef = ref(db, "HealthCare/Temperature/BodyTempC");
    const rawRef = ref(db, "HealthCare/PulseSensor/RawValue");

    // DOM references
    const elBpm = document.getElementById("bpm");
    const elTemp = document.getElementById("temp");
    const elRaw = document.getElementById("raw");
    const elStatusDot = document.getElementById("statusDot");
    const elStatusText = document.getElementById("statusText");
    const elConnText = document.getElementById("connText");
    const elBpmUpdated = document.getElementById("bpmUpdated");
    const elTempUpdated = document.getElementById("tempUpdated");
    const elRawUpdated = document.getElementById("rawUpdated");

    // Chart setup
    const ctx = document.getElementById("bpmChart").getContext("2d");
    const chartData = { labels: [], datasets: [{ label: "BPM", data: [], borderColor: "#2563eb", fill: true, backgroundColor: "rgba(37,99,235,0.1)", tension: 0.4 }] };
    const bpmChart = new Chart(ctx, { type: "line", data: chartData, options: { scales: { y: { min: 50, max: 130 } }, plugins: { legend: { display: false } } } });

    function setConnected(connected) {
      elStatusDot.className = connected ? "status-dot connected" : "status-dot";
      elStatusText.textContent = connected ? "Connected" : "Disconnected";
      elConnText.textContent = connected ? "Realtime connected" : "Disconnected";
    }

    function fmtTime() {
      const d = new Date();
      return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", second: "2-digit" });
    }

    // Listen to BPM
    onValue(bpmRef, (snap) => {
      const val = snap.val();
      if (val != null) {
        elBpm.innerHTML = `${val} <span class="metric-badge ${val>100?'critical':val<60?'warning':'normal'}">${val>100?'High':val<60?'Low':'Normal'}</span>`;
        elBpmUpdated.textContent = "Last update: " + fmtTime();
        chartData.labels.push(fmtTime());
        chartData.datasets[0].data.push(val);
        if (chartData.labels.length > 25) { chartData.labels.shift(); chartData.datasets[0].data.shift(); }
        bpmChart.update();
        setConnected(true);
      }
    });

    // Listen to Temperature
    onValue(tempRef, (snap) => {
      const val = snap.val();
      if (val != null) {
        const status = val > 38 ? "critical" : val < 35 ? "warning" : "normal";
        const label = val > 38 ? "High" : val < 35 ? "Low" : "Normal";
        elTemp.innerHTML = `${val.toFixed(1)}°C <span class="metric-badge ${status}">${label}</span>`;
        elTempUpdated.textContent = "Last update: " + fmtTime();
        setConnected(true);
      }
    });

    // Listen to Raw Pulse
    onValue(rawRef, (snap) => {
      const val = snap.val();
      if (val != null) {
        elRaw.textContent = val;
        elRawUpdated.textContent = "Last update: " + fmtTime();
        setConnected(true);
      }
    });
  </script>
</body>
</html>
