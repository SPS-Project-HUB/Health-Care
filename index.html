<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HealthCare — Live Dashboard</title>

  <!-- Simple styling -->
  <style>
    :root {
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --secondary: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 24px;
      line-height: 1.5;
    }

    .container {
      width: 100%;
      max-width: 1200px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .header-left h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }

    .header-left p {
      color: var(--text-muted);
      font-size: 14px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--card);
      border-radius: 50px;
      box-shadow: var(--shadow);
      font-size: 14px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--warning);
    }

    .status-dot.connected {
      background: var(--secondary);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }

    .card {
      background: var(--card);
      padding: 24px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      border: 1px solid var(--border);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(37, 99, 235, 0.1);
      color: var(--primary);
    }

    .card-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text);
    }

    .card-footer {
      font-size: 12px;
      color: var(--text-muted);
    }

    .chart-card {
      grid-column: 1 / -1;
      padding: 24px;
    }

    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .chart-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
    }

    .chart-container {
      height: 300px;
      margin-top: 16px;
    }

    footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      font-size: 14px;
      color: var(--text-muted);
      border-top: 1px solid var(--border);
    }

    .footer-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    @media (max-width: 1024px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
    }
  </style>

  <!-- Chart.js (for the rolling chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-left">
        <h1>HealthCare Dashboard</h1>
        <p>Real-time patient monitoring system</p>
      </div>
      <div class="status-indicator">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Connecting...</span>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Heart Rate</div>
          <div class="card-icon">
            <span class="material-icons" style="color: var(--danger);">favorite</span>
          </div>
        </div>
        <div id="bpm" class="card-value">--</div>
        <div class="card-footer" id="bpmUpdated">Last update: --</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Body Temperature</div>
          <div class="card-icon">
            <span class="material-icons" style="color: var(--warning);">thermostat</span>
          </div>
        </div>
        <div id="temp" class="card-value">--</div>
        <div class="card-footer" id="tempUpdated">Last update: --</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Pulse Sensor</div>
          <div class="card-icon">
            <span class="material-icons" style="color: var(--secondary);">show_chart</span>
          </div>
        </div>
        <div id="raw" class="card-value">--</div>
        <div class="card-footer" id="rawUpdated">Last update: --</div>
      </div>

      <div class="card chart-card">
        <div class="chart-header">
          <div class="chart-title">Heart Rate History</div>
          <div class="status-indicator">
            <div class="status-dot connected"></div>
            <span>Live data</span>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="bpmChart"></canvas>
        </div>
      </div>
    </div>

    <footer>
      <div class="footer-left">
        <div class="connection-status">
          <div class="status-dot" id="connDot"></div>
          <span id="connText">Disconnected</span>
        </div>
        <div>Hosted on GitHub Pages</div>
      </div>
      <div>Data from Firebase Realtime Database</div>
    </footer>
  </div>

  <!-- Firebase web modular SDK (v12.5.0) -->
  <script type="module">
    // Firebase imports (modular SDK)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    // --- Replace with your Firebase config (you provided this earlier) ---
    const firebaseConfig = {
      apiKey: "AIzaSyCXNdT863O6m5Q_suM1oG4KbjEd0DxLqQo",
      authDomain: "health-care-f0262.firebaseapp.com",
      databaseURL: "https://health-care-f0262-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "health-care-f0262",
      storageBucket: "health-care-f0262.firebasestorage.app",
      messagingSenderId: "1001741084003",
      appId: "1:1001741084003:web:3e1bfe9f0fa8b6a03c1f56"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Refs to your DB nodes
    const bpmRef = ref(db, 'HealthCare/HeartRate/BPM');
    const tempRef = ref(db, 'HealthCare/Temperature/BodyTempC');
    const rawRef = ref(db, 'HealthCare/PulseSensor/RawValue');

    // DOM elements
    const elBpm = document.getElementById('bpm');
    const elTemp = document.getElementById('temp');
    const elRaw = document.getElementById('raw');
    const elStatusDot = document.getElementById('statusDot');
    const elStatusText = document.getElementById('statusText');
    const elConnDot = document.getElementById('connDot');
    const elConnText = document.getElementById('connText');
    const elBpmUpdated = document.getElementById('bpmUpdated');
    const elTempUpdated = document.getElementById('tempUpdated');
    const elRawUpdated = document.getElementById('rawUpdated');

    // Chart setup (Chart.js)
    const ctx = document.getElementById('bpmChart').getContext('2d');
    const MAX_POINTS = 30;
    const chartData = {
      labels: [],
      datasets: [{
        label: 'BPM',
        data: [],
        fill: true,
        backgroundColor: 'rgba(37, 99, 235, 0.1)',
        borderColor: 'rgba(37, 99, 235, 1)',
        tension: 0.4,
        pointRadius: 3,
        pointBackgroundColor: 'rgba(37, 99, 235, 1)',
        pointBorderColor: '#ffffff',
        pointBorderWidth: 2,
        borderWidth: 2
      }]
    };
    const bpmChart = new Chart(ctx, {
      type: 'line',
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { 
            display: true,
            grid: {
              display: false
            }
          },
          y: { 
            beginAtZero: false, 
            suggestedMin: 40, 
            suggestedMax: 140,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          }
        },
        plugins: { 
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(255, 255, 255, 0.9)',
            titleColor: '#1e293b',
            bodyColor: '#64748b',
            borderColor: '#e2e8f0',
            borderWidth: 1,
            cornerRadius: 8,
            displayColors: false
          }
        }
      }
    });

    // Helper: format time
    function fmtTime(ts) {
      const d = new Date(ts);
      return d.toLocaleTimeString();
    }

    // Helper: add point to chart
    function addBpmPoint(value) {
      const t = new Date();
      const label = t.toLocaleTimeString();
      chartData.labels.push(label);
      chartData.datasets[0].data.push(Number(value) || 0);
      if (chartData.labels.length > MAX_POINTS) {
        chartData.labels.shift();
        chartData.datasets[0].data.shift();
      }
      bpmChart.update();
    }

    // Connection UI helper
    function setConnected(connected) {
      elStatusText.textContent = connected ? 'Connected' : 'Disconnected';
      elStatusDot.className = connected ? 'status-dot connected' : 'status-dot';
      elConnText.textContent = connected ? 'Realtime connected' : 'Disconnected';
      elConnDot.className = connected ? 'status-dot connected' : 'status-dot';
    }

    // Observe BPM
    onValue(bpmRef, (snap) => {
      const val = snap.exists() ? snap.val() : null;
      elBpm.textContent = val !== null ? Number(val).toFixed(0) : '--';
      elBpmUpdated.textContent = 'Last update: ' + fmtTime(Date.now());
      setConnected(true);
      addBpmPoint(val !== null ? val : 0);
    }, (err) => {
      console.warn('BPM listen error', err);
      setConnected(false);
    });

    // Observe Temperature
    onValue(tempRef, (snap) => {
      const val = snap.exists() ? snap.val() : null;
      elTemp.textContent = val !== null ? Number(val).toFixed(1) + ' °C' : '--';
      elTempUpdated.textContent = 'Last update: ' + fmtTime(Date.now());
      setConnected(true);
    }, (err) => {
      console.warn('Temp listen error', err);
      setConnected(false);
    });

    // Observe Raw pulse value
    onValue(rawRef, (snap) => {
      const val = snap.exists() ? snap.val() : null;
      elRaw.textContent = val !== null ? Number(val) : '--';
      elRawUpdated.textContent = 'Last update: ' + fmtTime(Date.now());
      setConnected(true);
    }, (err) => {
      console.warn('Raw listen error', err);
      setConnected(false);
    });

    // If nothing updates for a while, show disconnected
    let lastUpdate = Date.now();
    setInterval(() => {
      // simple heartbeat: if chart has no recent label updated, mark connected false after 25s
      const now = Date.now();
      if (bpmChart.data.labels.length === 0) {
        // no data yet: don't flip
        return;
      }
      // if last label older than 25s, consider disconnected
      const lastLabel = bpmChart.data.labels[bpmChart.data.labels.length-1];
      // can't convert label->time accurately; instead track latest update via bpmUpdated element
      const lastText = elBpmUpdated.textContent.replace('Last update: ','');
      const lastTs = Date.parse(lastText);
      if (!isNaN(lastTs) && (now - lastTs > 25000)) {
        setConnected(false);
      }
    }, 7000);

  </script>
</body>
</html>
